<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Summarizer Tool v3</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        textarea, select, input { width: 100%; margin-bottom: 10px; }
        button { margin-top: 10px; }
        #results, #debug { margin-top: 20px; white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Color Summarizer Tool v3</h1>
    <textarea id="imageUrl" rows="3" placeholder="Enter image URL here (one per line)"></textarea>
    <select id="precision">
        <option value="vlow">Very Low (50px)</option>
        <option value="low">Low (75px)</option>
        <option value="medium" selected>Medium (100px)</option>
        <option value="high">High (150px)</option>
        <option value="vhigh">Very High (200px)</option>
    </select>
    <select id="numClusters">
        <option value="0">No clustering</option>
        <option value="2">2 clusters</option>
        <option value="3">3 clusters</option>
        <option value="4">4 clusters</option>
        <option value="5" selected>5 clusters</option>
        <option value="10">10 clusters</option>
        <option value="15">15 clusters</option>
        <option value="20">20 clusters</option>
    </select>
    <select id="outputFormat">
        <option value="text">Plain Text</option>
        <option value="json" selected>JSON</option>
        <option value="xml">XML</option>
        <option value="html">HTML</option>
    </select>
    <label><input type="checkbox" id="includeHistogram"> Include Histogram</label>
    <label><input type="checkbox" id="includePixel"> Include Pixel Data</label>
    <button onclick="analyzeImages()">Analyze Images</button>
    <div id="results"></div>
    <div id="debug"></div>

    <script>
        async function analyzeImages() {
            const imageUrls = document.getElementById('imageUrl').value.trim().split('\n');
            const precision = document.getElementById('precision').value;
            const numClusters = document.getElementById('numClusters').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const includeHistogram = document.getElementById('includeHistogram').checked;
            const includePixel = document.getElementById('includePixel').checked;

            const resultsDiv = document.getElementById('results');
            const debugDiv = document.getElementById('debug');
            resultsDiv.innerHTML = 'Analyzing...';
            debugDiv.innerHTML = '';

            try {
                const response = await fetch('/.netlify/functions/color-summarizer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        imageUrls,
                        precision,
                        numClusters,
                        outputFormat,
                        includeHistogram,
                        includePixel
                    }),
                });

                const data = await response.json();
                debugDiv.innerHTML += `Response status: ${response.status}\n\n`;
                
                if (response.ok) {
                    resultsDiv.innerHTML = '';
                    data.forEach((result, index) => {
                        resultsDiv.innerHTML += `<h3>Image ${index + 1}</h3>`;
                        if (outputFormat === 'html') {
                            resultsDiv.innerHTML += result;
                        } else {
                            resultsDiv.innerHTML += `<pre>${typeof result === 'object' ? JSON.stringify(result, null, 2) : result}</pre>`;
                        }
                    });
                } else {
                    resultsDiv.textContent = `Error: ${data.error || response.statusText}`;
                }
            } catch (error) {
                console.error('Error details:', error);
                resultsDiv.textContent = `Error: ${error.message}`;
                debugDiv.innerHTML += `Error details: ${error}\n\n`;
            }
        }
    </script>
</body>
</html>
